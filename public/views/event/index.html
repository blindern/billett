<div class="page-header">
    <h1>
        <span class="eventgroup"><a href="eventgroup/{{event.eventgroup.id}}">{{event.eventgroup.title}}</a></span>
        {{event.title}}
    </h1>
</div>

<!-- TODO: thumb (p_image_src) -->
<!-- TODO: category (p_category) -->
<!-- TODO: ics-link -->

<dl class="dl-horizontal">
    <dt>Tid</dt>
    <dd>{{event.time_start|formatdate:'dddd D. MMMM YYYY'}} kl. {{event.time_start|formatdate:'HH:mm'}}
        <span ng-show="event.time_end">til {{event.time_end|formatdate:'HH:mm'}}</span>
    </dd>
    <dt ng-show="event.age_restriction">Aldersgrense</dt>
    <dd ng-show="event.age_restriction"><b>{{event.age_restriction}} år</b></dd>
</dl>

<!-- TODO: event custom text -->
<!-- TODO: event readmore link -->

<div ng-show="event.description" ng-bind-html="event.description"></div>

<div class="panel panel-default" ng-show="!event.is_selling">
    <div class="panel-body">
        Billetter for dette arrangementet er for øyeblikket ikke tilgjengelig.
    </div>
</div>

<div ng-show="event.is_selling">
    <div class="panel panel-default" ng-show="event.ticketgroups.length == 0">
        <div class="panel-body">
            Nettsalget for dette arrangementet har avsluttet. Evt. resterende billetter selges i døra.
        </div>
    </div>

    <!-- TODO: check if sold out -->

    <div ng-show="event.ticketgroups.length > 0">

        <div class="panel panel-default" ng-show="event.is_old">
            <div class="panel-body">
                Billettsalg for arrangementet er avsluttet.
            </div>
        </div>
        <div class="panel panel-default" ng-show="!event.is_old && event.is_timeout">
            <div class="panel-body">
                Nettsalget for dette arrangementet har avsluttet. Evt. resterende billetter selges i døra.
            </div>
        </div>

        <div ng-show="!event.is_old && !event.is_timeout && !reservation">
            <h2>Kjøp billetter</h2>
            <p>Ved kjøp av billetter får du tilsendt en elektronisk billett i PDF-format på
                e-post som printes ut eller tas med på mobiltelefon til arrangementet.
                <a href="om">Informasjon om billetter</a></p>

            <form class="form-horizontal panel panel-default">
                <div class="panel-heading">Velg ønskede billetter</div>
                <div class="panel-body">
                    <div class="hidden-xs row text-primary text-right form-group">
                        <div class="col-sm-2 col-sm-offset-5">Pris</div>
                        <div class="col-sm-2">Billettgebyr</div>
                    </div>

                    <div class="form-group" ng-repeat="ticketgroup in event.ticketgroups">
                        <div class="col-sm-5">
                            <label class="control-label">{{ticketgroup.title}}</label>
                        </div>
                        <div class="col-sm-2 control-label">
                            <p><span class="visible-xs-inline">Pris:</span> {{ticketgroup.price|price}}</p>
                        </div>
                        <div class="col-sm-2 control-label">
                            <p><span class="visible-xs-inline">Billettgebyr:</span> {{ticketgroup.fee|price}}</p>
                        </div>
                        <div class="col-sm-3">
                            <select ng-model="ticketgroup.order_count" class="form-control" ng-init="ticketgroup.order_count=0">
                                <option ng-repeat="i in (ticketgroup.limit||10)+1|range" value="{{i}}">{{i}} billett{{i==1?'':'er'}}</option>
                            </select>
                        </div>
                    </div>

                    <p class="text-center"><input type="submit" ng-click="proceed()" class="btn btn-primary" value="Gå videre"></p>
                </div>
            </form>
        </div>
    </div>
</div>

<div ng-show="reservation && !checkout">
    <div class="panel panel-warning" ng-show="reservation.tickets[0].event.id != event.id">
        <div class="panel-heading">Billetter</div>
        <div class="panel-body">
            Du holder allerede på å bestille billetter til <a ng-href="/event/{{reservation.tickets[0].event.alias||reservation.tickets[0].event.id}}">{{reservation.tickets[0].event.title}}</a> og må fullføre/avbryte den bestillingen først.
        </div>
    </div>
    <div class="panel panel-info" ng-show="reservation.tickets[0].event.id == event.id">
        <div class="panel-heading">Kjøpsinformasjon</div>
        <div class="panel-body">
            <form class="form-horizontal" ng-submit="!form.$valid || placeOrder()" name="form">
                <div class="form-group">
                    <label class="text-right col-sm-4">Valgte billetter</label>
                    <div class="col-sm-8">
                        <div ng-repeat="ticket in reservation.tickets">
                            {{ticket.event.title}}: {{ticket.ticket_group.title}} (#{{ticket.id}}) ({{ticket.ticket_group.price|price}} + {{ticket.ticket_group.fee|price}})
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="text-right col-sm-4">Totalt beløp</label>
                    <div class="col-sm-8">
                        {{reservation.total_amount|price}}
                    </div>
                </div>
                <div class="form-group" form-input-check="form,username">
                    <label class="control-label col-sm-4">Fullt navn</label>
                    <div class="col-sm-8">
                        <input type="text" name="username" ng-model="reservation.name" class="form-control" auto-focus required>
                    </div>
                </div>
                <div class="form-group" form-input-check="form,email">
                    <label class="control-label col-sm-4">E-postadresse</label>
                    <div class="col-sm-8">
                        <input type="email" name="email" ng-model="reservation.email" class="form-control" required>
                    </div>
                </div>
                <div class="form-group" form-input-check="form,phone">
                    <label class="control-label col-sm-4">Telefonnummer</label>
                    <div class="col-sm-8">
                        <input type="text" name="phone" ng-model="reservation.phone" class="form-control" ng-pattern="/^\+?\d+$/" required>
                    </div>
                </div>
                <!-- TODO: i gammel løsning hadde vi støtte for "nyhetsbrev"-"påmelding" -->
                <div class="form-group" form-input-check="form,terms">
                    <div class="col-sm-offset-4 col-sm-8">
                        <label>
                            <input type="checkbox" ng-model="reservation.terms" required>
                            Jeg godtar <a href="/salgsbetingelser" target="_blank">salgsbetingelsene</a>
                        </label>
                    </div>
                </div>
                <div class="text-center">
                    <input type="submit" value="Gå til betaling" class="btn btn-primary">
                    <input type="button" value="Avbryt" ng-click="abortOrder()" class="btn btn-danger">
                </div>
            </form>
        </div>
    </div>
</div>

<div ng-show="checkout">
    <div class="panel panel-info">
        <div class="panel-body">
            <form action="{{checkout.url}}" method="post">
                <input type="hidden" name="{{key}}" ng-value="value" ng-repeat="(key, value) in checkout.fields">
                <p>Du blir nå automatisk videresendt til betalingsskjemaet. Hvis du ikke blir videresendt innen 5 sekunder trykk på knappen nedenfor.</p>
                <input type="submit" value="Gå til betalingsskjema">
            </form>
        </div>
    </div>
</div>

<!-- TODO: visa/mastercard logoer -->
