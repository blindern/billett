<div class="page-header">
    <h1>
        <span class="eventgroup"><a href="eventgroup/{{event.eventgroup.id}}">{{event.eventgroup.title}}</a></span>
        {{event.title}} <span class="eventdate-header">({{event.time_start|formatdate:'DD.MM'}})</span>
    </h1>
</div>

<div class="event-page">

<!-- TODO: category (p_category) -->
<!-- TODO: ics-link -->

<div class="row">
    <div class="col-sm-5">

        <div class="event-image">
            <img ng-src="event/{{event.id}}/image" alt="">
        </div>

        <dl>
            <dt>Tidspunkt</dt>
            <dd>{{event.time_start|formatdate:'dddd D. MMMM YYYY'}} kl. {{event.time_start|formatdate:'HH:mm'}}
                <span ng-show="event.time_end">til {{event.time_end|formatdate:'HH:mm'}}</span>
            </dd>
            <dt ng-show="event.location">Sted</dt>
            <dd ng-show="event.location">{{event.location}}</dd>
            <dt ng-show="event.age_restriction">Aldersgrense</dt>
            <dd ng-show="event.age_restriction">{{event.age_restriction}} år</dd>
        </dl>

        <div ng-show="event.description" ng-bind="event.description" class="event-description"></div>

    </div>

<!-- TODO: event custom text -->
<!-- TODO: event readmore link -->

    <div class="col-sm-7">

        <div ng-show="!reservation">
            <div ng-show="event.web_selling_status == 'unknown'" class="panel panel-default">
                <div class="panel-body">
                    Informasjon om billetter for dette arrangementet er for øyeblikket ikke tilgjengelig.
                </div>
            </div>

            <div ng-show="event.web_selling_status == 'old'" class="panel panel-default">
                <div class="panel-body">
                    Billettsalg for arrangementet er avsluttet.
                </div>
            </div>

            <div ng-show="event.web_selling_status == 'no_web_tickets'" class="panel panel-default">
                <div class="panel-body">
                    Dette arrangementet selges ikke på nett eller har foreløpig ingen tilgjengelige billetter.
                </div>
            </div>

            <div ng-show="event.web_selling_status == 'timeout'" class="panel panel-default">
                <div class="panel-body">
                    Nettsalget for dette arrangementet har avsluttet. Evt. tilgjengelige billetter selges i døra.
                </div>
            </div>

            <div ng-show="event.web_selling_status == 'sold_out'" class="panel panel-default">
                <div class="panel-body">
                    Arrangementet er dessverre utsolgt. Sjekk tilbake senere for se å om det kanskje blir gjort nye billetter tilgjengelig.
                </div>
            </div>

            <div ng-show="event.web_selling_status == 'sale'">
                <form class="form-horizontal panel panel-default">
                    <div class="panel-heading">Kjøp billetter</div>
                    <div class="panel-body">

                        <p>Ved kjøp av billetter får du tilsendt en elektronisk billett i PDF-format på
                            e-post som printes ut eller tas med på mobiltelefon til arrangementet.
                            <a href="om">Informasjon om billetter</a></p>

                        <div class="form-group" ng-repeat="ticketgroup in event.ticketgroups">
                            <div class="col-sm-5">
                                <label class="control-label">{{ticketgroup.title}}</label>
                            </div>
                            <div class="col-sm-3 control-label">
                                <p><span class="visible-xs-inline">Pris:</span> {{ticketgroup.price+ticketgroup.fee|price:true}}</p>
                            </div>
                            <div class="col-sm-4">
                                <select ng-model="ticketgroup.order_count" class="form-control" ng-init="ticketgroup.order_count=0">
                                    <option ng-repeat="i in (ticketgroup.limit||10)+1|range" value="{{i}}">{{i}} stk</option>
                                </select>
                            </div>
                        </div>

                        <p class="text-center"><input type="submit" ng-click="proceed()" class="btn btn-primary" value="Gå videre"></p>
                        <div class="text-center text-muted">Billettprisene inkluderer evt. mva og billettgebyr.</div>
                    </div>
                </form>
                <p class="text-center">
                    <a href="http://www.dibs.no/">
                        <img src="https://cdn.dibspayment.com/logo/checkout/combo/horiz/DIBS_checkout_kombo_horizontal_02.png" alt="DIBS - Payments made easy" width="300"/>
                    </a>
                </p>
            </div>
        </div>

        <div ng-show="reservation && !checkout">
            <div class="panel panel-warning" ng-show="reservation.tickets[0].event.id != event.id">
                <div class="panel-heading">Billetter</div>
                <div class="panel-body">
                    Du holder allerede på å bestille billetter til <a ng-href="/event/{{reservation.tickets[0].event.alias||reservation.tickets[0].event.id}}">{{reservation.tickets[0].event.title}}</a> og må fullføre/avbryte den bestillingen først.
                </div>
            </div>
            <div class="panel panel-info" ng-show="reservation.tickets[0].event.id == event.id">
                <div class="panel-heading">Kjøp billetter</div>
                <div class="panel-body">
                    <p>Du har nå reservert billetter. For å ikke risikere og miste reservasjonen må du fullføre eller oppdatere skjemaet innen 10 minutter.</p>
                    <form class="form-horizontal" ng-submit="!form.$valid || placeOrder()" name="form">
                        <div class="form-group">
                            <label class="text-right col-sm-4">Valgte billetter</label>
                            <div class="col-sm-8">
                                <div ng-repeat="ticket in reservation.tickets">
                                    {{ticket.ticketgroup.title}} ({{ticket.ticketgroup.price+ticket.ticketgroup.fee|price:true}}) #{{ticket.id}}
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="text-right col-sm-4">Totalt å betale</label>
                            <div class="col-sm-8">
                                {{reservation.total_amount|price:true}}
                            </div>
                        </div>
                        <div class="form-group" form-input-check="form,username">
                            <label class="control-label col-sm-4">Fullt navn</label>
                            <div class="col-sm-8">
                                <input type="text" name="username" ng-model="reservation.name" class="form-control" auto-focus required>
                            </div>
                        </div>
                        <div class="form-group" form-input-check="form,email">
                            <label class="control-label col-sm-4">E-postadresse</label>
                            <div class="col-sm-8">
                                <input type="email" name="email" ng-model="reservation.email" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group" form-input-check="form,phone">
                            <label class="control-label col-sm-4">Telefonnummer</label>
                            <div class="col-sm-8">
                                <input type="tel" name="phone" ng-model="reservation.phone" class="form-control" ng-pattern="/^\+?\d+$/" required>
                            </div>
                        </div>
                        <!-- TODO: i gammel løsning hadde vi støtte for "nyhetsbrev"-"påmelding" -->
                        <div class="form-group" form-input-check="form,terms">
                            <div class="col-sm-offset-4 col-sm-8">
                                <label>
                                    <input type="checkbox" name="terms" ng-model="reservation.terms" required>
                                    Jeg godtar <a href="/salgsbetingelser" target="_blank">salgsbetingelsene</a>
                                </label>
                            </div>
                        </div>
                        <div class="text-center">
                            <input type="submit" value="Gå til betaling" class="btn btn-primary">
                            <input type="button" value="Overstyr betaling" ng-click="forceOrder()" class="btn btn-default">
                            <input type="button" value="Avbryt" ng-click="abortOrder()" class="btn btn-danger">
                        </div>
                    </form>
                </div>
            </div>
            <p class="text-center">
                <a href="http://www.dibs.no/">
                    <img src="https://cdn.dibspayment.com/logo/checkout/combo/horiz/DIBS_checkout_kombo_horizontal_02.png" alt="DIBS - Payments made easy" width="300"/>
                </a>
            </p>
        </div>

        <div ng-show="checkout">
            <div class="panel panel-info">
                <div class="panel-body">
                    <form action="{{checkout_url}}" method="post" id="checkoutForm">
                        <input type="hidden" name="{{key}}" ng-value="value" ng-repeat="(key, value) in checkout.fields">
                        <p>Du blir nå automatisk videresendt til betalingsskjemaet. Hvis du ikke blir videresendt innen 5 sekunder trykk på knappen nedenfor.</p>
                        <input type="submit" value="Gå til betalingsskjema">
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- TODO: visa/mastercard logoer -->

</div>